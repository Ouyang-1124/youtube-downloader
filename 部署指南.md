# Netlify 部署指南

这是一份详细的部署指南，帮助您将 YY 的 YouTube 视频下载网站部署到 Netlify 平台。

## 📋 部署前准备

### 1. 确保项目完整性

检查项目文件是否完整：
```
✅ package.json
✅ next.config.js
✅ netlify.toml
✅ app/ 文件夹
✅ components/ 文件夹
✅ netlify/functions/ 文件夹
```

### 2. 本地测试

在部署前先确保项目在本地正常运行：

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

访问 `http://localhost:3000` 确保功能正常。

## 🚀 方法一：GitHub + Netlify（推荐）

### 步骤 1: 创建 GitHub 仓库

1. 访问 [GitHub](https://github.com)
2. 点击右上角的 "+" → "New repository"
3. 仓库名称：`youtube-downloader`
4. 选择 "Public"（公开）
5. 点击 "Create repository"

### 步骤 2: 上传代码到 GitHub

在项目文件夹中执行：

```bash
# 初始化 Git 仓库
git init

# 添加所有文件
git add .

# 提交
git commit -m "Initial commit: YouTube downloader website"

# 添加远程仓库（替换为您的用户名）
git remote add origin https://github.com/您的用户名/youtube-downloader.git

# 推送到 GitHub
git push -u origin main
```

### 步骤 3: 连接 Netlify

1. 访问 [Netlify](https://app.netlify.com/)
2. 使用 GitHub 账户登录
3. 点击 "New site from Git"
4. 选择 "GitHub"
5. 找到并选择您的仓库 `youtube-downloader`
6. 配置构建设置：
   - **Branch to deploy**: `main`
   - **Build command**: `npm run build`
   - **Publish directory**: `out`
7. 点击 "Deploy site"

### 步骤 4: 等待部署完成

- 部署通常需要 2-5 分钟
- 您可以在 Netlify 控制台查看实时部署日志
- 部署成功后，您会获得一个临时域名

## 🌐 方法二：直接拖拽部署

### 步骤 1: 构建项目

```bash
# 安装依赖
npm install

# 构建生产版本
npm run build
```

### 步骤 2: 拖拽部署

1. 访问 [Netlify](https://app.netlify.com/)
2. 登录您的账户
3. 找到页面上的拖拽区域
4. 将构建生成的 `out` 文件夹拖拽到指定区域
5. 等待上传和部署完成

## ⚙️ 部署配置

### Netlify 配置文件 (netlify.toml)

项目已包含配置文件，主要设置：

```toml
[build]
  publish = "out"
  command = "npm run build"

[functions]
  directory = "netlify/functions"

# API 路由重定向
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200
```

### 环境变量（可选）

如果需要额外配置，在 Netlify 控制台中添加：

1. 进入 Site settings
2. 选择 "Environment variables"
3. 添加变量：
   - `NODE_VERSION`: `18`

## 🎯 自定义域名（可选）

### 步骤 1: 添加自定义域名

1. 在 Netlify 控制台中选择您的网站
2. 进入 "Domain settings"
3. 点击 "Add custom domain"
4. 输入您的域名（例如：`youtube-downloader.com`）

### 步骤 2: 配置 DNS

在您的域名注册商处添加以下记录：

```
类型: CNAME
名称: www
值: 您的netlify域名.netlify.app

类型: A
名称: @
值: 75.2.60.5
```

### 步骤 3: 启用 HTTPS

Netlify 会自动为您的域名申请 SSL 证书，通常在几分钟内完成。

## 🔧 部署后测试

### 功能测试清单

部署完成后，请测试以下功能：

- [ ] 页面正常加载
- [ ] 输入 YouTube 链接
- [ ] 点击"解析视频"按钮
- [ ] 视频信息正确显示
- [ ] 下载功能正常工作
- [ ] 进度条显示正常
- [ ] 历史记录保存和显示
- [ ] 响应式设计在移动设备上正常

### 测试用例

使用这些 YouTube 链接进行测试：

1. **短视频**: `https://www.youtube.com/watch?v=dQw4w9WgXcQ`
2. **长视频**: `https://www.youtube.com/watch?v=jNQXAC9IVRw`

## 🐛 常见部署问题

### 问题 1: 构建失败

**错误信息**: "Build failed"

**解决方案**:
1. 检查 `package.json` 中的依赖版本
2. 确保所有必需文件都已提交到 Git
3. 查看 Netlify 部署日志中的具体错误信息

### 问题 2: Functions 不工作

**错误信息**: "404 - Function not found"

**解决方案**:
1. 确保 `netlify/functions/` 文件夹已正确上传
2. 检查 `netlify.toml` 配置是否正确
3. 确认 API 路径配置正确

### 问题 3: CORS 错误

**错误信息**: "CORS policy blocked"

**解决方案**:
1. 检查 Functions 中的 CORS 头设置
2. 确保 `OPTIONS` 请求得到正确处理

### 问题 4: 下载超时

**错误信息**: "Function timeout"

**原因**: Netlify Functions 有 10 秒执行限制

**解决方案**:
1. 考虑使用流式下载
2. 实现分块下载
3. 对大文件提供下载链接而非直接下载

## 📊 监控和分析

### Netlify Analytics

1. 在网站控制台中启用 Analytics
2. 查看访问量统计
3. 监控 Functions 使用情况

### 部署钩子

设置自动部署：
1. 进入 "Build & deploy" 设置
2. 启用自动发布
3. 配置 GitHub 集成自动部署

## 🔄 更新和维护

### 更新代码

当您修改代码后：

```bash
# 提交更改
git add .
git commit -m "Update: description of changes"
git push

# Netlify 会自动重新部署
```

### 回滚版本

如果需要回滚：
1. 在 Netlify 控制台中选择 "Deploys"
2. 找到之前的成功部署版本
3. 点击 "Publish deploy"

## 📈 性能优化

### 建议优化项

1. **图片优化**: 使用 Next.js Image 组件
2. **代码分割**: 利用动态导入
3. **缓存策略**: 配置适当的缓存头
4. **CDN**: Netlify 自动提供全球 CDN

### 成本控制

Netlify 免费计划限制：
- 100GB 带宽/月
- 300 分钟构建时间/月
- 125,000 次 Functions 调用/月

## 🎉 部署成功

恭喜！您的 YouTube 视频下载网站已成功部署到 Netlify。

**下一步**:
1. 分享您的网站链接
2. 收集用户反馈
3. 持续改进和更新功能

---

如有任何问题，请参考 [Netlify 官方文档](https://docs.netlify.com/) 或在项目中提交 Issue。